<h1>Organiser <%= organiser %>'s Home Page</h1>
<p><%= settings.site_name %> - <%= settings.site_description %></p>

<form action="/logout" method="GET" style="margin-bottom: 20px;">
  <button type="submit">Logout</button>
</form>

<a href="/organiser/settings">Site Settings</a> <br>

<a href="/organiser/events/create" onclick="event.preventDefault(); document.getElementById('create-form').submit();">
  <button>Create New Event</button>
</a>

<form id="create-form" action="/organiser/events/create" method="POST" style="display:none;"></form>

<h2>Published Events</h2>
<table border="1" cellpadding="5" cellspacing="0">
  <tr>
    <th>Organiser</th>
    <th>Title</th>
    <th>Event description</th>
    <th>Difficulty</th>
    <th>Children friendly</th>
    <th>Date</th>
    <th>Created At</th>
    <th>Published At</th>
    <th>Ticket price</th>
    <th>Full Price Tickets</th>
    <th>Child ticket price</th>
    <th>Child Tickets</th>
    <th>Tickets booked</th>
    <th>Actions</th>
  </tr>
  <% published.forEach(event => { %>
    <tr>
        <td><%= event.organiser || '(No title)' %></td>
        <td><%= event.title || '(No title)' %></td>
        <td><%= event.description %></td>
        <td><%= event.difficulty %></td>
        <td>
          <%= event.children_friendly === 0 ? "No" : "Yes" %>
        </td>
        <td><%= event.event_date.split('T')[0] %></td>
        <td><%= event.created_at.split('T')[0] %></td>
        <td><%= event.published_at ? new Date(event.published_at).toLocaleString('en-GB', {
    year: 'numeric', month: '2-digit', day: '2-digit',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  }) : '----/--/--' %></td>
        <td>$<%= event.full_price_price %></td>
        <td><%= event.full_price_count %></td>
        <td>
          <%= event.children_friendly === 0 ? '-' : `$${event.child_price}` %>
        </td>
        <td>
          <%= event.children_friendly === 0 ? '-' : event.child_price_count %>
        </td>
        <td><%= event.child_price_count + event.full_price_count %>/<%= event.max_capacity %> (<%= ((event.child_price_count + event.full_price_count) / event.max_capacity * 100).toFixed(2) %>%)</td>
      <td>
        <a href="/organiser/events/edit/<%= event.id %>">Details</a> |
        <a href="/attendee/event/<%= event.id %>">
          attendee page
        </a> |
        <form action="/organiser/events/delete/<%= event.id %>" method="POST" style="display:inline;">
          <button type="submit" onclick="return confirm('Delete this event?');">Delete</button>
        </form>
      </td>
    </tr>
  <% }); %>
</table>

<h2>Draft Events</h2>
<table border="1" cellpadding="5" cellspacing="0">
  <tr>
    <th>Title</th>
    <th>Event description</th>
    <th>Difficulty</th>
    <th>Children friendly</th>
    <th>Date</th>
    <th>Created At</th>
    <th>Last updated</th>
    <th>Ticket price</th>
    <th>Child ticket price</th>
    <th>Tickets available</th>
    <th>Actions</th>
  </tr>
  <% drafts.forEach(event => { %>
    <tr>
      <td><%= event.title || '(No title)' %></td>
      <td><%= event.description %></td>
      <td><%= event.difficulty %></td>
      <td>
        <%= event.children_friendly === 0 ? "No" : "Yes" %>
      </td>
      <td><%= event.event_date.split('T')[0] %></td>
      <td><%= event.created_at.split('T')[0] %></td>
      <td><%= new Date(event.updated_at).toLocaleString('en-GB', {
    year: 'numeric', month: '2-digit', day: '2-digit',
    hour: '2-digit', minute: '2-digit', second: '2-digit'
  }) %></td>
      <td>$<%= event.full_price_price %></td>
      <td>
        <%= event.children_friendly === 0 ? '-' : `$${event.child_price}` %>
      </td>
      <td><%= event.max_capacity %></td>
      <td>
        <a href="/organiser/events/edit/<%= event.id %>">Edit</a> |
        <form action="/organiser/events/publish/<%= event.id %>" method="POST" style="display:inline;">
          <button type="submit">Publish</button>
        </form> |
        <form action="/organiser/events/delete/<%= event.id %>" method="POST" style="display:inline;">
          <button type="submit" onclick="return confirm('Delete this draft?');">Delete</button>
        </form>
      </td>
    </tr>
  <% }); %>
</table>
